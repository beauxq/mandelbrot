(()=>{"use strict";function t(t,A,o,e){return[o*o-e*e+t,o*e*2+A]}function A(A,o){for(var e,i=0,n=0,s=0,a=0;a<=4&&s<512;)a=(i=(e=t(A,o,i,n))[0])*i+(n=e[1])*n,++s;return s+1/Math.max(a-4,1)}const o=function(){function t(t,A){if(0===A)throw new Error("k can't be zero");this._b=t,this.k=A,this.calculate()}return t.prototype.calculate=function(){this.a=1/this._b,this.bma=this._b-this.a,this.kDivBmA=this.k/this.bma,console.log("calculate results:"),console.log(this)},t.prototype.unscaled=function(t){return-1/(t+this.a)+this._b},t.prototype.f=function(t){return Number.isFinite(this.kDivBmA)?this.unscaled(t/this.kDivBmA)*this.kDivBmA:t},Object.defineProperty(t.prototype,"b",{get:function(){return this._b},set:function(t){this._b=t,this.calculate()},enumerable:!1,configurable:!0}),t}(),e=function(){function t(t,A,o,e){this.working=!1,WebAssembly&&WebAssembly.Instance&&WebAssembly.Module&&(this.instance=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(function(t){for(var A=window.atob("AGFzbQEAAAABHwZgAAF/YAAAYAJ8fABgBX9/fHx8AX9gAX8AYAF/AX8DCQgBAAIDAAQFAAQFAXABAQEFBgEBgAKAAgYJAX8BQaCRygYLB5ABCgZtZW1vcnkCABFfX3dhc21fY2FsbF9jdG9ycwAABXBvaW50AAEJaW5pdFRyYW5zAAIEZHJhdwADGV9faW5kaXJlY3RfZnVuY3Rpb25fdGFibGUBABBfX2Vycm5vX2xvY2F0aW9uAAcJc3RhY2tTYXZlAAQMc3RhY2tSZXN0b3JlAAUKc3RhY2tBbGxvYwAGCoEFCAMAAQsFAEGACAtdAQJ8IABEAAAAAAAAAABiBEBBgJGKBCAAOQMAQYiRigREAAAAAAAA8D8gAKMiAjkDAERUYBnUX4grSSEDQZCRigQgASAAIAKhoyADIABEAAAAAAAA8D9iGzkDAAsL8QMCB38LfCABQQBKBEAgAiAAt6MhDkGAkYoEKwMAIRNBiJGKBCsDACEUQZCRigQrAwAhDANAQQAhCiAAQQBKBEAgDiAIt6IgBKAhFQNAIA4gCreiIAOgIRZEAAAAAAAAAAAhDUEAIQZEAAAAAAAAAAAhD0QAAAAAAAAAACEQRAAAAAAAAAAAIQIDQAJAIAZBAWohByAWIBAgD6GgIhEgEaIiECAVIA0gDaAgAqKgIgIgAqIiD6AiEkQAAAAAAAAQQGVFDQAgBkH/A0khBSARIQ0gByEGIAUNAQsLQQAhBgJ/RAAAAAAAAPA/RAAAAAAAAPA/IBJEAAAAAAAAEMCgoyASRAAAAAAAABRAYxsgB7egIgJEAAAAAAAAgEBjRQRAQQAhB0EAIQtBAAwBCwJ/IAxEVGAZ1F+IK0liBEAgDCATRAAAAAAAAPC/IAIgDKMgFKCjoKIhAgsgAplEAAAAAAAA4EFjBEAgAqoMAQtBgICAgHgLIgVBgAJOBEAgBUGAAmshBkGAgIB4IQtBACEHQf8DIAVrDAELQf8BIAVrIQdBgICAeCELIAULIQUgCUECdEGACGogBUEIdCAHciAGQRB0ciALcjYCACAJQQFqIQkgCkEBaiIKIABHDQALCyAIQQFqIgggAUcNAAsLQYAIKAIACwQAIwALBgAgACQACxAAIwAgAGtBcHEiACQAIAALBwBBmJGKBAs="),o=new Uint8Array(A.length),e=0;e<A.length;++e)o[e]=A.charCodeAt(e);return o.buffer}()))),this.working=!!(this.instance&&this.instance.exports&&this.instance.exports.initTrans&&this.instance.exports.draw&&this.instance.exports.point)),console.log("WebAssembly working:",this.working),console.log("wa instance:"),console.log(this.instance),this.working&&(this.exports=this.instance.exports,this.updateB(o,e),this.resize(t,A))}return t.prototype.updateB=function(t,A){this.exports.initTrans(t,A)},t.prototype.resize=function(t,A){var o=this.exports.point();console.log("pointer",o),this.data=new Uint8ClampedArray(this.exports.memory.buffer,o,t*A*4),this.img=new ImageData(this.data,t,A)},t.prototype.draw=function(t,A,o,e,i,n){var s=this.exports.draw(A,o,e,i,n);console.log("color or top left pixel",s),t.putImageData(this.img,0,0)},t.prototype.logPixels=function(t){for(var A=[],o=0;o<4*t;++o)A.push(this.data[o]);console.log(A)},t}(),i=function(){function t(t,A){var i=this;this.canvas=document.getElementById("c"),this.canvas.width=t,this.canvas.height=A,this.context=this.canvas.getContext("2d"),this.leftX=-2.5,this.zoomE=8,this.topY=-this.zoomH/2,this.changed=!0,this.ct=new o(5,512),this.wa=new e(t,A,5,512),this.canvas.addEventListener("click",(function(){i.wa.working||(i.ct.b=Math.min(20,i.ct.b+1)),i.changed=!0})),this.canvas.addEventListener("contextmenu",(function(t){t.preventDefault(),i.wa.working||(i.ct.b=Math.max(1,i.ct.b-1)),i.changed=!0})),this.canvas.addEventListener("wheel",(function(o){var e=o.deltaY>0,n=o.offsetX,s=o.offsetY,a=n/t,h=s/A,r=i.leftX+a*i.zoomW,c=i.topY+h*i.zoomH;console.log("mx",r,"my",c),e?(i.zoomE=Math.min(16,i.zoomE+1),console.log("zoom out",i.zoomE)):(i.zoomE=i.zoomE-1,console.log("zoom in ",i.zoomE)),i.leftX=r-a*i.zoomW,i.topY=c-h*i.zoomH,i.changed=!0})),console.log("should be 0",this.ct.f(0)),console.log("should be 511",this.ct.f(511)),console.log("should be ~43",this.ct.f(3)),console.log("should be ~100",this.ct.f(11)),console.log("should be ~150",this.ct.f(17)),requestAnimationFrame((function(){i.draw()}))}return t.prototype.resize=function(t,A){this.canvas.width=t,this.canvas.height=A,this.context=this.canvas.getContext("2d"),this.wa.resize(t,A),this.changed=!0},Object.defineProperty(t.prototype,"zoomW",{get:function(){return Math.pow(2,this.zoomE/4)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zoomH",{get:function(){return this.zoomW*this.canvas.height/this.canvas.width},enumerable:!1,configurable:!0}),t.prototype.draw=function(){var t=this;this.changed&&(this.wa.working?this.wa.draw(this.context,this.canvas.width,this.canvas.height,this.zoomW,this.leftX,this.topY):this.jsDraw(),console.log("draw completed"),this.changed=!1),requestAnimationFrame((function(){t.draw()}))},t.prototype.jsDraw=function(){for(var t=this.context.createImageData(this.canvas.width,this.canvas.height),o=this.zoomW/this.canvas.width,e=0,i=0;i<this.canvas.height;++i)for(var n=0;n<this.canvas.width;++n){var s=A(n*o+this.leftX,i*o+this.topY);if(s<512){var a=void 0,h=void 0,r=void 0;(s=Math.floor(this.ct.f(s)))>255?(h=255-(r=s-256),a=0):(a=255-s,h=s,r=0);var c=4*e;t.data[c]=a,t.data[c+1]=h,t.data[c+2]=r,t.data[c+3]=255}++e}this.context.putImageData(t,0,0)},t}();var n;window.onload=function(){!function(){for(var t=0;t<32;++t){var o=t/32+1e-6;console.log(o,A(o,0))}}();var t=window.innerWidth,o=window.innerHeight;n=new i(t,o)},window.addEventListener("resize",(function(){console.log("browserZoomLevel: "+window.devicePixelRatio);var t=window.innerWidth,A=Math.max(window.innerHeight,document.documentElement.clientHeight);null==n||n.resize(t,A)}),!1),window.onorientationchange=function(){var t=document.getElementsByTagName("html")[0],A=document.getElementsByTagName("body")[0];window.innerWidth<window.innerHeight?(t.style.overflowX="hidden",A.style.overflowX="hidden"):(t.style.overflowX="auto",A.style.overflowX="auto")}})();